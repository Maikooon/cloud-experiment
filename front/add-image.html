<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>栄養表示ページ</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script type="module">
      import json from "./data.json" assert { type: "json" };
      // 画像を読み込んだら関数実行
      function changeImageToBase64() {
        const uploadImage = document.querySelector('#uploadImage')
        const file = uploadImage.files[0]

        const reader = new FileReader()

           
          
        // ファイルを読み取った後にコールバックで行われる処理
        reader.onload = (event) => {
          const base64Text = event.currentTarget.result
           // json形式にする
          const obj = {"attatchment":{"base64":base64Text}};
          // Post通信
          const postRes = fetch("https://yprgdia3yl.execute-api.us-east-1.amazonaws.com/dev/upload", {
            method: "POST",
            headers:{
              'Content-Type': 'applicarion/json'
            },
            body: JSON.stringify(obj),
          });
          // base64Textにテキストをつけて、画像を#uploadImageAreaに表示
          document.querySelector('#base64text').value = base64Text;
          document.querySelector('#uploadImageArea').innerHTML = `<img src="${base64Text}" width="100%" />`;
          
          // jsonデータを読み込む(json)
          const parsed = JSON.parse(json);
          document.querySelector('#result').value = parsed
          console.dir(obj);

        }
        reader.readAsDataURL(file)
        
      }
    </script>
  </head>
  <body>
    <div id="main">
      <center><p>今日のご飯をアップロードする</p></center>
    </div>
    
    <form>
      <div class="center">
        <input type="file" class="form-control file" id="uploadImage" />
        <center><button type="button" class="btn btn-primary form-control w-25" onclick="changeImageToBase64()">計算する</button></center>  
        <br>
      </div>
      <div id="uploadImageArea"></div> 
    </form>
    
    <div>
        <center><p>計算結果</p></center>
    </div>
  
  </body>
</html>


